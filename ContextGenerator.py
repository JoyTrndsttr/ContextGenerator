import psycopg2
from psycopg2 import sql
from ContextGenerators.getContextGenerators import LanguageContextGenerator
import getProjectCommitState
import logging
import ErrorProcess
import json
import model
import re
import traceback

# Setting up logging
# logging.basicConfig(filename='log.txt', level=logging.ERROR, format='%(asctime)s:%(levelname)s:%(message)s')

# 数据库连接配置
db_config = {
    'dbname': 'HCGGraph',
    'user': 'user',
    'password': '123456',
    'host': 'localhost',
    'port': '5432'
}

# 从postgres数据库获取所有id
def get_db_info():
    conn = psycopg2.connect(**db_config)
    cursor = conn.cursor()
    cursor.execute("SELECT _id from cacr_py")
    while True:
        record = cursor.fetchone()
        if record is None:
            break
        yield record

# 主函数
def main(_id):
    # ids = ErrorProcess.error_ids2
    # with open('/mnt/ssd2/wangke/CR_data/dataset/cacr_python_test_with_llama_all.json', 'w') as f0:
    with open('/mnt/ssd2/wangke/CR_data/dataset/cacr_python_with_llama_error_process.json', 'w') as f0:
        f0.write('[\n')
        first_record = True
        with open('/mnt/ssd2/wangke/CR_data/dataset/cacr_python_test.json', 'r') as f:
            records = json.load(f)
            new_records = []
            for record in records:
                try:
                    # if record['_id'] > _id : continue
                    if not record['_id'] == _id: continue
                    id = record['_id']
                    print(f'processing: {id}')
                    old_without_minus = model.remove_minus_or_plus(record['old'], '-')
                    new_without_plus = model.remove_minus_or_plus(record['new'], '+')

                    # 获取仓库在commit提交前的状态
                    attempt = 0
                    while attempt < 1:
                        try:
                            successful_checkout = getProjectCommitState.main(id)
                            if successful_checkout:
                                break
                        except Exception as e:
                            attempt += 1
                            print(f'Error processing ID {id}: {e}')
                            if attempt ==3:
                                logging.error(f'Error processing ID {id}: {e}', exc_info=True)  # Log error with stack trace
                                raise Exception(f'获取仓库在commit提交前的状态失败')
                    
                    #ReAct框架 
                    turn, flag_for_more_info, flag_for_context_change = 0, True, True
                    
                    languageContextGenerator = LanguageContextGenerator(id)
                    if not languageContextGenerator: return None
                    contextGenerator = languageContextGenerator.context_generator
                    calls = [] #元组格式，（调用的函数，被调用的函数，被调用函数的实现）
                    results = [] #存储每一个turn的结果
                    name = "" #存储要检索的函数名

                    while turn < 6 and flag_for_more_info and flag_for_context_change:
                        turn += 1
                        if name: contextGenerator.updateSource(name)
                        definitions = contextGenerator.getContext()
                        result = {"turn": turn, "prompt_for_refinement": "", "result_json": "", "prompt_for_instruction": "", "em": 0, "em_trim": 0, "bleu": 0, "bleu_trim": 0}
                        
                        max_attempts = 3
                        # 第二步：根据context、old_code和review生成new_code，并评估结果（这里放前面是要不加context先评估一次）
                        for i in range(max_attempts):
                            result["prompt_for_refinement"] = model.prompt_for_refinement(old_without_minus, record["review"], calls)
                            new_code, answer = model.get_model_response(result["prompt_for_refinement"])
                            if not new_code: continue
                            em, em_trim, bleu, bleu_trim = model.calc_em_and_bleu(new_code, new_without_plus)
                            if bleu_trim > result["bleu_trim"]: #取最好值
                                result["em"], result["em_trim"], result["bleu"], result["bleu_trim"] = em, em_trim, bleu, bleu_trim
                                result["new_code"] = new_code.split('\n')

                        # 第一步：判断是否要继续寻找information，给出要查找的函数名
                        flag_for_context_change = False    #用于判断模型有没有给出有效的函数名以继续查找context
                        for i in range(max_attempts):
                            result["prompt_for_instruction"] = model.prompt_for_instruction(old_without_minus, record["review"], calls)
                            answer_code, result["result_json"] = model.get_model_response(result["prompt_for_instruction"])
                            if not result["result_json"]: continue
                            # flag = re.findall(r'"need more information\?": "(.*?)",', result_json)[0]
                            # if not flag: continue
                            # flag = False if flag == "False" else True
                            name = re.findall(r'"function_name": "(.*?)",', result["result_json"])
                            if len(name) == 0: continue
                            name = name[0]
                            #在definitions中查找name，并存入函数调用关系以及被调用函数的实现
                            
                            definition_name = next((definition for definition in definitions if definition['name'] == name), None)
                            if definition_name:
                                exist_name = next((call[1] for call in calls if call[1] == name), None)
                                if exist_name: continue #如果已经存在该函数的调用关系，则跳过
                                calls.append((definition_name['caller'], name, definition_name['text']))
                                flag_for_context_change = True
                                break
                        #调整result的格式以方便阅读
                        result["prompt_for_instruction"] = result["prompt_for_instruction"].split('\n')
                        result["prompt_for_refinement"] = result["prompt_for_refinement"].split('\n')
                        result["result_json"] = result["result_json"].split('\n')
                        results.append(result)
                    
                    record["results"] = results
                    record["context"] = json.dumps(definitions)
                    record["llama_em"] = sum(result["em"] for result in results)/len(results)
                    record["llama_em_trim"] = sum(result["em_trim"] for result in results)/len(results)
                    record["llama_bleu"] = sum(result["bleu"] for result in results)/len(results)
                    record["llama_bleu_trim"] = sum(result["bleu_trim"] for result in results)/len(results)

                    #写入文件
                    if not first_record:
                        f0.write(',\n')  # 写入逗号和换行
                    first_record = False
                    json.dump(record, f0, indent=4)
                    new_records.append(record)

                except Exception as e:
                    print(f'Error processing ID {id}: {e}')
                    print(traceback.print_exc())
            print(f"All {len(new_records)} records processed")
        f0.write('\n]')
if __name__ == "__main__":
    ids = [25, 30, 42, 59, 62, 68, 71, 71, 82, 84, 86, 86, 87, 87, 90, 90, 91, 91, 92, 92, 96, 96, 99, 99, 113, 115, 117, 117, 121, 126, 126, 127, 131, 132, 134, 146, 146, 148, 152, 155, 155, 157, 157, 158, 158, 159, 162, 164, 179, 183, 206, 213, 218, 218, 221, 229, 229, 233, 233, 239, 239, 244, 244, 245, 246, 250, 251, 254, 254, 262, 262, 271, 271, 273, 273, 276, 277, 289, 289, 293, 293, 294, 297, 314, 314, 317, 317, 324, 324, 326, 326, 330, 330, 331, 331, 335, 335, 347, 347, 349, 349, 353, 353, 362, 362, 383, 384, 387, 387, 397, 397, 401, 408, 408, 412, 412, 413, 413, 417, 417, 421, 421, 427, 427, 446, 451, 451, 453, 453, 456, 461, 461, 465, 465, 466, 466, 468, 468, 470, 470, 474, 482, 482, 490, 490, 494, 494, 504, 504, 505, 505, 521, 525, 545, 553, 553, 560, 561, 561, 563, 563, 565, 565, 567, 567, 569, 569, 574, 574, 576, 579, 588, 589, 614, 615, 618, 632, 632, 638, 640, 644, 665, 678, 703, 720, 726, 733, 739, 762, 769, 782, 787, 809, 810, 824, 825, 825, 828, 856, 869, 869, 870, 872, 876, 888, 894, 906, 916, 927, 937, 942, 944, 956, 982, 985, 994, 1003, 1004, 1013, 1015, 1034, 1052, 1079, 1079, 1094, 1101, 1103, 1108, 1141, 1143, 1155, 1180, 1187, 1193, 1209, 1214, 1215, 1215, 1223, 1244, 1269, 1273, 1275, 1296, 1298, 1312, 1314, 1340, 1347, 1354, 1355, 1367, 1371, 1375, 1385, 1387, 1387, 1395, 1408, 1415, 1461, 1467, 1476, 1483, 1490, 1492, 1512, 1521, 1524, 1543, 1549, 1569, 1581, 1585, 1601, 1606, 1617, 1621, 1682, 1683, 1698, 1710, 1728, 1763, 1777, 1785, 1789, 1791, 1794, 1800, 1804, 1815, 1815, 1837, 1861, 1866, 1869, 1870, 1873, 1898, 1901, 1919, 1924, 1940, 1944, 1948, 1964, 1970, 1972, 1982, 1983, 1991, 2017, 2021, 2041, 2046, 2057, 2069, 2089, 2102, 2104, 2118, 2129, 2137, 2139, 2151, 2155, 2164, 2165, 2171, 2172, 2173, 2175, 2177, 2178, 2183, 2186, 2189, 2210, 2211, 2217, 2218, 2218, 2228, 2252, 2260, 2266, 2281, 2294, 2312, 2357, 2364, 2366, 2390, 2395, 2409, 2417, 2419, 2420, 2451, 2465, 2471, 2483, 2487, 2490, 2492, 2505, 2510, 2512, 2513, 2530, 2530, 2540, 2548, 2563, 2564, 2575, 2593, 2602, 2605, 2608, 2613, 2616, 2617, 2630, 2632, 2634, 2649, 2671, 2672, 2682, 2692, 2729, 2752, 2754, 2759, 2787, 2818, 2821, 2823, 2844, 2852, 2853, 2859, 2863, 2866, 2868, 2884, 2891, 2903, 2908, 2912, 2919, 2928, 2963, 2971, 2981, 2982, 3004, 3004, 3023, 3032, 3048, 3048, 3067, 3093, 3140, 3187, 3193, 3228, 3234, 3234, 3239, 3249, 3263, 3265, 3274, 3283, 3286, 3291, 3303, 3308, 3339, 3348, 3355, 3377, 3385, 3387, 3389, 3395, 3404, 3409, 3410, 3425, 3427, 3445, 3449, 3465, 3486, 3500, 3510, 3517, 3519, 3536, 3552, 3557, 3566, 3579, 3580, 3582, 3583, 3587, 3606, 3608, 3609, 3613, 3616, 3620, 3642, 3650, 3667, 3676, 3677, 3679, 3683, 3688, 3725, 3729, 3736, 3746, 3747, 3747, 3750, 3750, 3752, 3760, 3760, 3773, 3782, 3801, 3803, 3807, 3813, 3824, 3825, 3826, 3832, 3841, 3843, 3844, 3844, 3845, 3846, 3847, 3847, 3848, 3849, 3850, 3851, 3851, 3852, 3853, 3854, 3855, 3856, 3857, 3857, 3858, 3858, 3859, 3860, 3860, 3862, 3866, 3867, 3868, 3869, 3871, 3872, 3876, 3877, 3877, 3878, 3878, 3879, 3880, 3881, 3881, 3882, 3883, 3884, 3885, 3886, 3886, 3887, 3888, 3888, 3889, 3889, 3896, 3899, 3900, 3901, 3902, 3903, 3904, 3905, 3906, 3907, 3908, 3908, 3909, 3910, 3911, 3912, 3913, 3914, 3916, 3918, 3919, 3920, 3921, 3923, 3924, 3925, 3926, 3927, 3936, 3938, 3939, 3944, 3945, 3946, 3947, 3947, 3948, 3949, 3955, 3956, 3957, 3962, 3966, 3971, 3993, 4000, 4002, 4003, 4003, 4004, 4005, 4010, 4012, 4016, 4026, 4028, 4036, 4040, 4040, 4042, 4049, 4056, 4058, 4061, 4068, 4071, 4075, 4085, 4086, 4091, 4108, 4117, 4119, 4119, 4120, 4125, 4132, 4135, 4140, 4148, 4150, 4150, 4168, 4170, 4173, 4177, 4178, 4185, 4191, 4192, 4193, 4194, 4194, 4195, 4196, 4197, 4198, 4198, 4199, 4200, 4200, 4201, 4202, 4203, 4203, 4204, 4204, 4205, 4206, 4206, 4207, 4208, 4209, 4210, 4211, 4212, 4213, 4214, 4215, 4215, 4216, 4216, 4217, 4217, 4218, 4219, 4220, 4220, 4221, 4222, 4223, 4223, 4224, 4225, 4225, 4226, 4227, 4228, 4229, 4230, 4231, 4232, 4233, 4234, 4234, 4235, 4235, 4236, 4237, 4238, 4239, 4240, 4241, 4242, 4243, 4243, 4244, 4245, 4245, 4246, 4247, 4248, 4248, 4249, 4250, 4251, 4252, 4253, 4254, 4254, 4255, 4255, 4256, 4257, 4258, 4259, 4260, 4261, 4262, 4263, 4264, 4265, 4266, 4266, 4267, 4268, 4269, 4270, 4271, 4271, 4272, 4273, 4273, 4274, 4275, 4276, 4276, 4277, 4278, 4279, 4280, 4280, 4281, 4282, 4282, 4283, 4284, 4285, 4285, 4286, 4286, 4287, 4287, 4288, 4289, 4290, 4291, 4292, 4292, 4293, 4294, 4295, 4296, 4298, 4302, 4315, 4323, 4330, 4334, 4338, 4340, 4343, 4344, 4365, 4370, 4374, 4382, 4383, 4384, 4385, 4386, 4398, 4399, 4399, 4400, 4401, 4402, 4403, 4404, 4404, 4405, 4406, 4407, 4407, 4408, 4408, 4409, 4410, 4411, 4412, 4412, 4413, 4414, 4415, 4416, 4417, 4418, 4419, 4420, 4421, 4421, 4422, 4422, 4423, 4424, 4425, 4426, 4427, 4428, 4429, 4430, 4431, 4432, 4433, 4434, 4434, 4435, 4436, 4437, 4437, 4438, 4439, 4440, 4441, 4442, 4442, 4453, 4465, 4479, 4496, 4505, 4511, 4525, 4545, 4550, 4556, 4559, 4561, 4562, 4575, 4582, 4587, 4588, 4601, 4603, 4603, 4610, 4619, 4622, 4624, 4627, 4655, 4663, 4665, 4668, 4669, 4674, 4678, 4687, 4692, 4696, 4697, 4701, 4704, 4705, 4712, 4713, 4733, 4733, 4735, 4793, 4793, 4834, 4851, 4860, 4870, 4877, 4889, 4892, 4905, 4906, 4916, 4935, 4966, 4967, 4983, 4995, 5032, 5038, 5039, 5039, 5040, 5040, 5041, 5042, 5043, 5044, 5045, 5046, 5047, 5048, 5049, 5050, 5051, 5052, 5053, 5054, 5054, 5055, 5056, 5057, 5058, 5059, 5059, 5060, 5061, 5062, 5063, 5064, 5065, 5066, 5066, 5067, 5068, 5069, 5070, 5071, 5072, 5073, 5074, 5075, 5076, 5077, 5082, 5083, 5083, 5084, 5085, 5086, 5087, 5088, 5089, 5090, 5091, 5092, 5094, 5094, 5095, 5096, 5097, 5098, 5099, 5099, 5100, 5102, 5104, 5104, 5105, 5105, 5106, 5106, 5107, 5107, 5108, 5109, 5110, 5112, 5113, 5113, 5114, 5115, 5116, 5117, 5119, 5120, 5122, 5124, 5125, 5126, 5130, 5139, 5143, 5145, 5146, 5146, 5147, 5147, 5149, 5161, 5167, 5186, 5196, 5197, 5198, 5208, 5227, 5238, 5239, 5240, 5241, 5242, 5243, 5243, 5244, 5245, 5246, 5247, 5248, 5248, 5249, 5250, 5251, 5253, 5254, 5254, 5255, 5262, 5272, 5276, 5279, 5284, 5291, 5296, 5298, 5305, 5305, 5324, 5350, 5356, 5360, 5381, 5381, 5382, 5383, 5384, 5385, 5386, 5387, 5388, 5405, 5420, 5426, 5432, 5450, 5451, 5456, 5462, 5462, 5498, 5516, 5520, 5559, 5564, 5572, 5583, 5592, 5593, 5594, 5614, 5615, 5621, 5622, 5627, 5627, 5630, 5631, 5632, 5632, 5633, 5634, 5635, 5636, 5637, 5638, 5638, 5639, 5640, 5641, 5641, 5642, 5643, 5643, 5644, 5644, 5645, 5646, 5647, 5647, 5648, 5649, 5650, 5650, 5651, 5652, 5653, 5654, 5654, 5655, 5656, 5656, 5657, 5658, 5659, 5660, 5660, 5661, 5662, 5663, 5664, 5665, 5666, 5666, 5667, 5668, 5668, 5669, 5669, 5670, 5671, 5671, 5672, 5672, 5673, 5674, 5675, 5676, 5677, 5677, 5678, 5679, 5679, 5680, 5680, 5681, 5682, 5683, 5684, 5685, 5686, 5687, 5688, 5688, 5689, 5690, 5690, 5691, 5691, 5692, 5693, 5694, 5694, 5695, 5696, 5697, 5697, 5698, 5698, 5699, 5699, 5700, 5700, 5701, 5701, 5702, 5702, 5703, 5703, 5704, 5705, 5706, 5712, 5718, 5719, 5719, 5720, 5732, 5732, 5734, 5748, 5750, 5760, 5766, 5768, 5772, 5776, 5783, 5784, 5784, 5785, 5786, 5787, 5787, 5788, 5788, 5789, 5790, 5791, 5791, 5792, 5793, 5794, 5795, 5795, 5796, 5796, 5797, 5797, 5798, 5799, 5800, 5800, 5801, 5801, 5802, 5803, 5804, 5805, 5805, 5806, 5807, 5808, 5808, 5809, 5810, 5811, 5812, 5818, 5826, 5870, 5878, 5919, 5921, 5924, 5932, 5933, 5934, 5935, 5936, 5937, 5938, 5939, 5940, 5941, 5942, 5942, 5943, 5943, 5944, 5945, 5946, 5948, 5950, 5956, 5956, 5957, 5959, 5962, 5965, 5967, 5969, 5970, 5976, 5980, 5986, 5988, 5997, 6004, 6009, 6010, 6011, 6012, 6012, 6013, 6013, 6014, 6015, 6016, 6017, 6017, 6018, 6019, 6020, 6021, 6022, 6023, 6024, 6024, 6025, 6026, 6027, 6027, 6028, 6028, 6029, 6029, 6030, 6031, 6031, 6032, 6032, 6033, 6034, 6034, 6035, 6036, 6037, 6038, 6039, 6040, 6040, 6041, 6042, 6042, 6043, 6044, 6045, 6045, 6046, 6047, 6047, 6048, 6049, 6050, 6050, 6051, 6052, 6052, 6053, 6054, 6055, 6056, 6057, 6057, 6058, 6058, 6059, 6059, 6060, 6061, 6061, 6062, 6062, 6063, 6064, 6065, 6066, 6067, 6068, 6069, 6070, 6071, 6071, 6072, 6072, 6073, 6074, 6075, 6076, 6077, 6077, 6078, 6078, 6079, 6080, 6081, 6082, 6083, 6084, 6084, 6085, 6086, 6087, 6088, 6088, 6088, 6088, 6089, 6090, 6091, 6092, 6092, 6093, 6094, 6095, 6096, 6111, 6112, 6113, 6116, 6117, 6118, 6119, 6120, 6120, 6129, 6132, 6133, 6145, 6155, 6157, 6158, 6161, 6161, 6177, 6189, 6194, 6197, 6209, 6210, 6220, 6234, 6235, 6236, 6237, 6242, 6243, 6244, 6246, 6252, 6254, 6260, 6261, 6261, 6265, 6270, 6276, 6283, 6315, 6316, 6316, 6317, 6317, 6318, 6318, 6319, 6319, 6320, 6320, 6321, 6321, 6322, 6322, 6323, 6323, 6325, 6325, 6335, 6338, 6339, 6340, 6341, 6342, 6343, 6346, 6346, 6347, 6348, 6348, 6349, 6350, 6352, 6352, 6354, 6371, 6380, 6380, 6383, 6385, 6431, 6437, 6442, 6452, 6453, 6475, 6477, 6481, 6497, 6504, 6512, 6513, 6513, 6517, 6520, 6525, 6535, 6536, 6543, 6551, 6557, 6559, 6572, 6587, 6621, 6630, 6639, 6651, 6657, 6662, 6663, 6670, 6674, 6682, 6692, 6701, 6712, 6723, 6727, 6729, 6735, 6736, 6747, 6767, 6777, 6792, 6801, 6817, 6818, 6821, 6832, 6848, 6852, 6867, 6869, 6869, 6870, 6871, 6871, 6872, 6873, 6874, 6875, 6876, 6876, 6878, 6878, 6879, 6879, 6880, 6880, 6881, 6882, 6883, 6884, 6884, 6885, 6885, 6886, 6886, 6888, 6889, 6889, 6890, 6890, 6891, 6892, 6893, 6894, 6895, 6902, 6917, 6921, 6927, 6936, 6937, 6945, 6947, 6949, 6964, 6967, 6969, 6970, 6970, 6971, 6972, 6973, 6974, 6975, 6976, 6977, 6978, 6979, 6980, 6981, 6982, 6983, 6984, 6985, 6986, 6987, 6988, 6989, 6990, 6995, 6997, 7006, 7014, 7018, 7026, 7034, 7052, 7058, 7064, 7081, 7082, 7095, 7097, 7102, 7102, 7106, 7107, 7107, 7108, 7108, 7120, 7120, 7121, 7121, 7124, 7124, 7125, 7125, 7126, 7126, 7127, 7127, 7128, 7128, 7130, 7130, 7143, 7187, 7189, 7193, 7207, 7218, 7220, 7228, 7236, 7237, 7238, 7239, 7240, 7241, 7241, 7242, 7243, 7244, 7245, 7246, 7246, 7247, 7248, 7249, 7250, 7251, 7251, 7252, 7253, 7254, 7254, 7255, 7255, 7256, 7256, 7257, 7258, 7259, 7260, 7261, 7262, 7263, 7264, 7265, 7266, 7267, 7268, 7269, 7270, 7271, 7272, 7272, 7273, 7274, 7274, 7275, 7276, 7277, 7278, 7279, 7280, 7281, 7282, 7283, 7284, 7285, 7285, 7286, 7287, 7288, 7289, 7290, 7291, 7306, 7312, 7387, 7394, 7406, 7407, 7438, 7444, 7455, 7462, 7464, 7475, 7480, 7481, 7491, 7527, 7540, 7543, 7551, 7553, 7563, 7566, 7567, 7583, 7585, 7586, 7604, 7614, 7615, 7626, 7636, 7644, 7663, 7669, 7672, 7697, 7706, 7712, 7714, 7715, 7738, 7767, 7773, 7799, 7827, 7832, 7849, 7861, 7866, 7872, 7888, 7891, 7896, 7896, 7907, 7924, 7928, 7941, 7941, 7958, 7969, 7973, 7973, 7974, 7974, 7975, 7975, 7976, 7976, 7977, 7977, 7978, 7978, 7992, 8002, 8007, 8027, 8041, 8047, 8054, 8086, 8089, 8091, 8100, 8146, 8161, 8165, 8167, 8177, 8188, 8194, 8196, 8204, 8212, 8217, 8219, 8229, 8230, 8231, 8235, 8251, 8274, 8282, 8288, 8316, 8320, 8332, 8332, 8340, 8340, 8345, 8348, 8348, 8358, 8361, 8371, 8374, 8389, 8391, 8397, 8417, 8417, 8435, 8439, 8441, 8441, 8451, 8455, 8458, 8458, 8466, 8471, 8472, 8478, 8488, 8500, 8515, 8521, 8527, 8530, 8530, 8534, 8549, 8576, 8584, 8601, 8605, 8607, 8608, 8608, 8611, 8620, 8625, 8630, 8641, 8644, 8648, 8650, 8651, 8674, 8676, 8680, 8680, 8686, 8689, 8689, 8690, 8690, 8691, 8692, 8693, 8694, 8695, 8696, 8696, 8697, 8697, 8698, 8699, 8699, 8700, 8701, 8702, 8703, 8704, 8706, 8707, 8708, 8709, 8710, 8711, 8711, 8712, 8712, 8713, 8714, 8714, 8715, 8716, 8717, 8718, 8719, 8720, 8721, 8721, 8722, 8723, 8723, 8724, 8725, 8726, 8727, 8728, 8729, 8730, 8731, 8732, 8733, 8734, 8735, 8735, 8736, 8736, 8737, 8738, 8739, 8740, 8741, 8742, 8743, 8744, 8745, 8746, 8747, 8747, 8748, 8748, 8748, 8748, 8749, 8750, 8751, 8752, 8753, 8754, 8755, 8761, 8761, 8765, 8765, 8766, 8766, 8767, 8767, 8768, 8768, 8773, 8773, 8774, 8774, 8776, 8778, 8779, 8781, 8782, 8783, 8784, 8785, 8786, 8787, 8787, 8788, 8788, 8789, 8789, 8790, 8791, 8792, 8793, 8794, 8795, 8796, 8798, 8800, 8801, 8803, 8805, 8806, 8807, 8808, 8809, 8810, 8811, 8813, 8814, 8815, 8815, 8816, 8818, 8820, 8824, 8824, 8826, 8828, 8830, 8831, 8833, 8834, 8835, 8837, 8837, 8838, 8839, 8839, 8840, 8842, 8843, 8844, 8845, 8846, 8847, 8849, 8849, 8850, 8851, 8851, 8852, 8853, 8854, 8855, 8856, 8857, 8858, 8859, 8860, 8861, 8862, 8863, 8864, 8865, 8866, 8866, 8867, 8868, 8869, 8870, 8870, 8871, 8871, 8880, 8890, 8892, 8897, 8907, 8919, 8935, 8951, 8959, 8966, 8970, 8978, 8985, 8994, 9016, 9017, 9020, 9020, 9021, 9021, 9022, 9022, 9023, 9023, 9024, 9024, 9025, 9025, 9026, 9026, 9031, 9031, 9055, 9056, 9072, 9073, 9077, 9084, 9093, 9097, 9098, 9099, 9100, 9101, 9102, 9103, 9104, 9105, 9106, 9106, 9107, 9108, 9109, 9109, 9110, 9111, 9112, 9113, 9114, 9115, 9115, 9116, 9117, 9118, 9119, 9120, 9121, 9122, 9123, 9124, 9125, 9126, 9126, 9127, 9128, 9129, 9130, 9130, 9131, 9131, 9132, 9133, 9134, 9134, 9135, 9136, 9136, 9137, 9138, 9138, 9139, 9140, 9140, 9141, 9142, 9142, 9143, 9143, 9144, 9145, 9145, 9146, 9147, 9148, 9149, 9150, 9151, 9151, 9152, 9152, 9153, 9153, 9154, 9155, 9156, 9156, 9157, 9158, 9159, 9160, 9161, 9162, 9163, 9164, 9164, 9165, 9166, 9167, 9168, 9169, 9170, 9171, 9173, 9194, 9212, 9236, 9240, 9258, 9277, 9287, 9289, 9297, 9297, 9298, 9299, 9299, 9301, 9301, 9305, 9306, 9307, 9309, 9310, 9311, 9315, 9324, 9325, 9326, 9327, 9328, 9328, 9331, 9333, 9334, 9336, 9339, 9340, 9341, 9342, 9343, 9345, 9346, 9347, 9348, 9349, 9350, 9354, 9358, 9359, 9361, 9362, 9363, 9364, 9367, 9368, 9369, 9371, 9371, 9372, 9373, 9374, 9374, 9375, 9376, 9377, 9378, 9378, 9382, 9383, 9384, 9385, 9386, 9387, 9388, 9389, 9389, 9390, 9392, 9393, 9393, 9394, 9394, 9396, 9399, 9400, 9401, 9402, 9402, 9403, 9405, 9406, 9407, 9408, 9408, 9419, 9426, 9427, 9440, 9442, 9443, 9444, 9445, 9446, 9447, 9447, 9448, 9450, 9452, 9465, 9469, 9470, 9470, 9471, 9478, 9479, 9480, 9481, 9483, 9484, 9487, 9488, 9491, 9492, 9492, 9496, 9500, 9501, 9502, 9502, 9509, 9511, 9511, 9522, 9547, 9552, 9559, 9560, 9561, 9564, 9569, 9580, 9585, 9585, 9586, 9586, 9587, 9587, 9588, 9588, 9589, 9589, 9590, 9590, 9591, 9591, 9592, 9592, 9593, 9593, 9594, 9594, 9594, 9594, 9595, 9595, 9596, 9596, 9597, 9597, 9598, 9598, 9599, 9599, 9600, 9600, 9601, 9601, 9602, 9602, 9603, 9603, 9604, 9604, 9605, 9605, 9606, 9606, 9607, 9607, 9608, 9608, 9609, 9609, 9610, 9610, 9611, 9611, 9612, 9612, 9613, 9613, 9614, 9614, 9615, 9615, 9616, 9616, 9617, 9617, 9618, 9618, 9619, 9619, 9620, 9620, 9621, 9621, 9622, 9622, 9623, 9623, 9624, 9624, 9625, 9625, 9626, 9626, 9627, 9627, 9628, 9628, 9629, 9629, 9630, 9630, 9631, 9631, 9632, 9632, 9633, 9633, 9634, 9634, 9635, 9635, 9636, 9636, 9637, 9637, 9638, 9638, 9639, 9639, 9640, 9640, 9641, 9641, 9642, 9642, 9643, 9643, 9644, 9644, 9645, 9645, 9646, 9646, 9647, 9647, 9648, 9648, 9649, 9649, 9650, 9650, 9651, 9651, 9652, 9652, 9653, 9653, 9654, 9654, 9655, 9655, 9656, 9656, 9657, 9657, 9658, 9658, 9659, 9659, 9660, 9660, 9661, 9661, 9662, 9662, 9663, 9663, 9664, 9664, 9665, 9665, 9666, 9666, 9667, 9667, 9668, 9668, 9669, 9669, 9670, 9670, 9671, 9671, 9672, 9672, 9673, 9673, 9674, 9674, 9675, 9675, 9676, 9676, 9677, 9677, 9677, 9678, 9678, 9679, 9679, 9680, 9680, 9681, 9681, 9682, 9682, 9683, 9683, 9684, 9684, 9685, 9685, 9686, 9686, 9687, 9687, 9688, 9688, 9689, 9689, 9690, 9690, 9691, 9691, 9692, 9692, 9693, 9693, 9694, 9694, 9695, 9695, 9696, 9696, 9697, 9697, 9698, 9698, 9699, 9699, 9700, 9700, 9701, 9701, 9702, 9702, 9703, 9703, 9704, 9704, 9705, 9705, 9706, 9706, 9707, 9707, 9708, 9708, 9709, 9709, 9710, 9710, 9711, 9711, 9712, 9712, 9713, 9713, 9714, 9714, 9715, 9715, 9716, 9716, 9717, 9717, 9718, 9718, 9719, 9719, 9720, 9720, 9721, 9721, 9722, 9722, 9723, 9723, 9724, 9724, 9725, 9725, 9726, 9726, 9727, 9727, 9728, 9728, 9729, 9729, 9730, 9730, 9731, 9731, 9732, 9732, 9733, 9733, 9734, 9734, 9735, 9735, 9736, 9736, 9737, 9737, 9738, 9738, 9739, 9739, 9740, 9740, 9741, 9741, 9742, 9742, 9743, 9743, 9744, 9744, 9745, 9745, 9746, 9746, 9747, 9747, 9748, 9748, 9749, 9749, 9750, 9750, 9751, 9751, 9752, 9752, 9753, 9753, 9754, 9754, 9755, 9755, 9756, 9756, 9757, 9757, 9758, 9758, 9759, 9759, 9760, 9760, 9761, 9761, 9762, 9762, 9763, 9763, 9764, 9764, 9765, 9765, 9766, 9766, 9766, 9767, 9767, 9768, 9768, 9769, 9769, 9770, 9770, 9771, 9771, 9772, 9772, 9773, 9773, 9774, 9774, 9775, 9775, 9776, 9776, 9777, 9777, 9778, 9778, 9779, 9779, 9780, 9780, 9781, 9781, 9782, 9782, 9783, 9783, 9784, 9784, 9785, 9785, 9786, 9786, 9787, 9787, 9788, 9788, 9789, 9789, 9790, 9790, 9791, 9791, 9792, 9792, 9793, 9793, 9794, 9794, 9820, 9821, 9823, 9828, 9830, 9832, 9844, 9845, 9849, 9850, 9851, 9853, 9860, 9866, 9867, 9894, 9894, 9902, 9905, 9915, 9921, 9931, 9962, 9967, 9967, 9972, 9980, 9988, 9989, 9996, 9998, 10000, 10001, 10007, 10008, 10026, 10028, 10032, 10059, 10060, 10063, 10067, 10067, 10068, 10069, 10069, 10070, 10070, 10071, 10072, 10073, 10074, 10075, 10076, 10077, 10078, 10079, 10079, 10080, 10081, 10082, 10083, 10084, 10085, 10086, 10087, 10087, 10099, 10107, 10111, 10116, 10117, 10117, 10118, 10118, 10119, 10119, 10120, 10121, 10121, 10122, 10122, 10123, 10123, 10124, 10125, 10126, 10126, 10127, 10128, 10129, 10132, 10133, 10141, 10144, 10147, 10175, 10175, 10179, 10184, 10207, 10215, 10223, 10227, 10251, 10273, 10283, 10285, 10296, 10301, 10307, 10308, 10318, 10319, 10319, 10320, 10321, 10321, 10322, 10323, 10324, 10325, 10325, 10326, 10327, 10328, 10328, 10329, 10330, 10334, 10336, 10337, 10337, 10338, 10339, 10340, 10341, 10342, 10343, 10343, 10345, 10345, 10346, 10347, 10348, 10349, 10360, 10363, 10373, 10382, 10393, 10394, 10395, 10396, 10396, 10397, 10407, 10426, 10432, 10434, 10443, 10470, 10478, 10485, 10485, 10488, 10494, 10495, 10503, 10511, 10513, 10514, 10515, 10516, 10517, 10518, 10519, 10519, 10521, 10522, 10522, 10523, 10524, 10525, 10526, 10527, 10528, 10529, 10529, 10530, 10531, 10532, 10533, 10534, 10535, 10536, 10536, 10537, 10537, 10538, 10541, 10543, 10546, 10551, 10568, 10573, 10575, 10580, 10606, 10608, 10618, 10622, 10626, 10629, 10629, 10630, 10631, 10631, 10632, 10633, 10634, 10635, 10636, 10637, 10637, 10638, 10639, 10639, 10640, 10641, 10642, 10643, 10643, 10644, 10645, 10646, 10647, 10648, 10649, 10650, 10651, 10651, 10652, 10652, 10653, 10653, 10654, 10655, 10656, 10657, 10658, 10659, 10660, 10660, 10661, 10662, 10663, 10664, 10664, 10665, 10666, 10667, 10667, 10668, 10669, 10670, 10671, 10672, 10672, 10673, 10674, 10675, 10676, 10677, 10678, 10678, 10679, 10680, 10681, 10681, 10682, 10682, 10683, 10684, 10685, 10686, 10686, 10687, 10688, 10688, 10689, 10690, 10691, 10691, 10692, 10693, 10694, 10695, 10696, 10696, 10697, 10698, 10699, 10700, 10701, 10702, 10703, 10704, 10705, 10706, 10706, 10707, 10708, 10709, 10710, 10711, 10711, 10712, 10713, 10714, 10715, 10716, 10716, 10717, 10717, 10718, 10719, 10720, 10721, 10721, 10722, 10723, 10724, 10724, 10725, 10726, 10726, 10727, 10728, 10729, 10730, 10731, 10732, 10732, 10733, 10734, 10734, 10735, 10736, 10737, 10738, 10738, 10739, 10740, 10741, 10742, 10743, 10744, 10744, 10745, 10746, 10747, 10748, 10749, 10750, 10751, 10751, 10752, 10752, 10753, 10754, 10755, 10755, 10756, 10757, 10758, 10759, 10759, 10760, 10760, 10761, 10762, 10763, 10764, 10764, 10765, 10766, 10767, 10768, 10769, 10770, 10771, 10772, 10773, 10787, 10789, 10796, 10826, 10833, 10837, 10850, 10865, 10872, 10888, 10897, 10897, 10903, 10906, 10910, 10913, 10915, 10927, 10928, 10929, 10929, 10930, 10930, 10931, 10932, 10932, 10933, 10935, 10937, 10938, 10939, 10939, 10940, 10941, 10942, 10943, 10944, 10961, 10968, 10990, 10998, 11014, 11029, 11031, 11039, 11040, 11041, 11042, 11043, 11043, 11044, 11044, 11045, 11045, 11046, 11047, 11048, 11049, 11050, 11051, 11052, 11052, 11053, 11053, 11054, 11054, 11055, 11056, 11057, 11058, 11059, 11059, 11060, 11061, 11062, 11062, 11063, 11063, 11064, 11065, 11066, 11066, 11067, 11068, 11068, 11069, 11070, 11070, 11071, 11080, 11089, 11091, 11092, 11096, 11119, 11124, 11124, 11129, 11134, 11135, 11137, 11147, 11156, 11168, 11169, 11182, 11199, 11225, 11228, 11233, 11234, 11236, 11244, 11253, 11281, 11284, 11285, 11288, 11291, 11302, 11303, 11315, 11315, 11316, 11318, 11357, 11364, 11367, 11398, 11399, 11400, 11402, 11406, 11441, 11448, 11449, 11458, 11470, 11477, 11488, 11489, 11490, 11491, 11492, 11493, 11494, 11495, 11496, 11497, 11498, 11498, 11499, 11500, 11500, 11501, 11502, 11503, 11504, 11504, 11505, 11506, 11507, 11508, 11509, 11509, 11510, 11511, 11512, 11512, 11513, 11514, 11515, 11516, 11516, 11517, 11518, 11519, 11520, 11537, 11539, 11550, 11551, 11553, 11553, 11557, 11557, 11558, 11559, 11559, 11560, 11580, 11580, 11581, 11581, 11582, 11583, 11583, 11584, 11585, 11586, 11587, 11588, 11589, 11590, 11591, 11592, 11593, 11593, 11594, 11594, 11595, 11596, 11597, 11598, 11599, 11600, 11601, 11602, 11603, 11603, 11604, 11605, 11606, 11606, 11607, 11608, 11609, 11610, 11610, 11611, 11612, 11613, 11613, 11614, 11614, 11614, 11616, 11616, 11618, 11619, 11621, 11622, 11626, 11627, 11654, 11663, 11665, 11665, 11671, 11676, 11676, 11680, 11684, 11690, 11695, 11695, 11696, 11697, 11700, 11701, 11702, 11703, 11703, 11704, 11705, 11706, 11706, 11712, 11735, 11744, 11746, 11755, 11757, 11764, 11765, 11770, 11771, 11777, 11782, 11786, 11786, 11791, 11801, 11809, 11828, 11832, 11841, 11856, 11879, 11897, 11901, 11904, 11911, 11912, 11912, 11913, 11913, 11914, 11915, 11916, 11916, 11917, 11918, 11919, 11920, 11920, 11921, 11921, 11922, 11923, 11923, 11924, 11925, 11926, 11935, 11939, 11940, 11940, 11941, 11942, 11942, 11943, 11943, 11944, 11944, 11957, 11967, 11970, 11977, 11977, 11978, 11978, 11988, 11989, 12000, 12003, 12003, 12016, 12023, 12025, 12041, 12049, 12050, 12052, 12060, 12062, 12065, 12066, 12067, 12068, 12068, 12069, 12070, 12071, 12074, 12076, 12079, 12087, 12088, 12089, 12090, 12091, 12091, 12092, 12092, 12093, 12093, 12094, 12095, 12095, 12096, 12097, 12098, 12098, 12106, 12108, 12109, 12124, 12132, 12139, 12144, 12151, 12152, 12164, 12168, 12177, 12195, 12214, 12220, 12235, 12267, 12304, 12319, 12323, 12334, 12334, 12340, 12352, 12357, 12378, 12385, 12407, 12409, 12413, 12415, 12420, 12430, 12431, 12438, 12441, 12448, 12448, 12449, 12460, 12466, 12472, 12498, 12511, 12513, 12516, 12534, 12547, 12555, 12555, 12560, 12568, 12571, 12572, 12574, 12574, 12575, 12575, 12576, 12577, 12577, 12578, 12579, 12579, 12580, 12581, 12581, 12582, 12583, 12584, 12585, 12585, 12586, 12586, 12587, 12588, 12589, 12593, 12593, 12594, 12594, 12597, 12598, 12599, 12600, 12601, 12602, 12603, 12605, 12607, 12607, 12610, 12610, 12611, 12612, 12614, 12615, 12615, 12616, 12617, 12617, 12618, 12619, 12621, 12622, 12623, 12624, 12624, 12625, 12626, 12629, 12641, 12651, 12674, 12674, 12675, 12675, 12676, 12676, 12677, 12677, 12678, 12678, 12687, 12688, 12688, 12694, 12709, 12711, 12713, 12714, 12715, 12716, 12716, 12717, 12717, 12718, 12718, 12719, 12719, 12720, 12721, 12721, 12722, 12722, 12723, 12723, 12724, 12724, 12725, 12725, 12726, 12726, 12727, 12727, 12728, 12728, 12729, 12730, 12731, 12732, 12732, 12733, 12734, 12735, 12736, 12737, 12741, 12745, 12756, 12760, 12771, 12785, 12786, 12786, 12789, 12790, 12793, 12795, 12796, 12797, 12798, 12798, 12799, 12800, 12802, 12803, 12804, 12804, 12805, 12809, 12811, 12812, 12813, 12814, 12823, 12824, 12825, 12826, 12830, 12831, 12832, 12833, 12835, 12835, 12836, 12837, 12838, 12839, 12840, 12845, 12853, 12857, 12858, 12873, 12873, 12874, 12874, 12875, 12875, 12876, 12876, 12877, 12877, 12878, 12878, 12879, 12879, 12880, 12880, 12881, 12881, 12882, 12882, 12883, 12883, 12884, 12884, 12885, 12885, 12886, 12886, 12887, 12887, 12887, 12887, 12888, 12888, 12889, 12889, 12890, 12890, 12891, 12891, 12892, 12892, 12893, 12893, 12894, 12894, 12895, 12895, 12896, 12896, 12897, 12897, 12898, 12898, 12899, 12899, 12900, 12900, 12901, 12901, 12902, 12902, 12903, 12903, 12904, 12904, 12905, 12905, 12906, 12906, 12907, 12907, 12908, 12908, 12909, 12909, 12910, 12910, 12911, 12911, 12912, 12912, 12913, 12913, 12914, 12914, 12915, 12915, 12916, 12916, 12917, 12917, 12918, 12918, 12919, 12919, 12920, 12920, 12921, 12921, 12922, 12922, 12923, 12923, 12924, 12924, 12925, 12925, 12926, 12926, 12927, 12927, 12928, 12928, 12929, 12929, 12930, 12930, 12931, 12931, 12932, 12932, 12933, 12933, 12934, 12934, 12935, 12935, 12936, 12936, 12937, 12937, 12938, 12938, 12939, 12939, 12940, 12940, 12941, 12941, 12942, 12942, 12943, 12943, 12944, 12944, 12945, 12945, 12946, 12946, 12947, 12947, 12949, 12957, 12958, 12962, 13001, 13002, 13007, 13010, 13011, 13011, 13012, 13012, 13019, 13022, 13022, 13028, 13031, 13037, 13038, 13043, 13044, 13045, 13046, 13046, 13047, 13048, 13050, 13050, 13051, 13051, 13051, 13052, 13053, 13054, 13055, 13056, 13056, 13057, 13058, 13059, 13060, 13061, 13062, 13063, 13064, 13065, 13071, 13075, 13080, 13081, 13082, 13082, 13083, 13084, 13084, 13087, 13102, 13165, 13166, 13167, 13168, 13169, 13170, 13171, 13172, 13173, 13174, 13174, 13175, 13176, 13177, 13178, 13179, 13179, 13180, 13181, 13182, 13183, 13184, 13184, 13185, 13186, 13187, 13188, 13189, 13190, 13191, 13192, 13193, 13194, 13195, 13196, 13197, 13198, 13199, 13200, 13201, 13202, 13203, 13204, 13205, 13206, 13207, 13208, 13209, 13210, 13211, 13212, 13213, 13214, 13215, 13216, 13217, 13218, 13219, 13220, 13221, 13222, 13223, 13224, 13225, 13226, 13227, 13228, 13229, 13230, 13231, 13232, 13233, 13234, 13235, 13236, 13237, 13238, 13239, 13240, 13241, 13242, 13243, 13244, 13245, 13246, 13247, 13248, 13249, 13250, 13251, 13252, 13253, 13254, 13255, 13256, 13257, 13258, 13259, 13260, 13261, 13262, 13263, 13264, 13265, 13266, 13267, 13267, 13268, 13269, 13270, 13271, 13272, 13273, 13276, 13276, 13277, 13278, 13279, 13280, 13281, 13282, 13283, 13284, 13285, 13286, 13287, 13288, 13289, 13290, 13291, 13292, 13293, 13294, 13295, 13296, 13297, 13298, 13299, 13300, 13301, 13302, 13303, 13304, 13305, 13306, 13307, 13308, 13309, 13310, 13311, 13312, 13313, 13314, 13315, 13316, 13317, 13318, 13319, 13320, 13321, 13322, 13323, 13324, 13325, 13326, 13327, 13328, 13329, 13330, 13331, 13332, 13333, 13334, 13335, 13336, 13337, 13338, 13339, 13340, 13341, 13342, 13343, 13344, 13345, 13346, 13347, 13348, 13349, 13350, 13351, 13352, 13353, 13354, 13355, 13356, 13357, 13358, 13359, 13360, 13360, 13361, 13361, 13362, 13363, 13364, 13365, 13366, 13367, 13368, 13369, 13370, 13371, 13372, 13373, 13374, 13375, 13376, 13377, 13378, 13378, 13379, 13379, 13380, 13380, 13381, 13382, 13383, 13384, 13385, 13386, 13387, 13388, 13389, 13390, 13390, 13391, 13391, 13392, 13392, 13393, 13394, 13395, 13396, 13397, 14677, 14678, 14680, 14681, 14682, 14685, 14743, 14744]
    for id in ids:
        main(id)